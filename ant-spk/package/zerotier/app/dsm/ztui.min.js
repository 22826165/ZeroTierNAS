var ZeroTierNetwork=React.createClass({displayName:"ZeroTierNetwork",getInitialState:function(){return{}},leaveNetwork:function(e){Ajax.call({url:"http://"+window.local_address+":3090/network/"+this.props.nwid+"?"+window.CSRF_TOKEN_KEY+"="+window.CSRF_TOKEN_VAL+"&"+window.COOKIE_KEY+"="+window.COOKIE_VAL,cache:!1,type:"DELETE",success:function(e){this.props.onNetworkDeleted&&this.props.onNetworkDeleted(this.props.nwid)}.bind(this),error:function(e){}.bind(this)}),e.preventDefault()},render:function(){return React.createElement("div",{className:"zeroTierNetwork"},React.createElement("div",{className:"networkInfo"},React.createElement("span",{className:"networkId"},this.props.nwid)," ",React.createElement("span",{className:"networkName"},this.props.name)),React.createElement("div",{className:"networkProps"},React.createElement("div",{className:"row"},React.createElement("div",{className:"name"},"Status"),React.createElement("div",{className:"value"},this.props.status)),React.createElement("div",{className:"row"},React.createElement("div",{className:"name"},"Type"),React.createElement("div",{className:"value"},this.props.type)),React.createElement("div",{className:"row"},React.createElement("div",{className:"name"},"MAC"),React.createElement("div",{className:"value zeroTierAddress"},this.props.mac)),React.createElement("div",{className:"row"},React.createElement("div",{className:"name"},"MTU"),React.createElement("div",{className:"value"},this.props.mtu)),React.createElement("div",{className:"row"},React.createElement("div",{className:"name"},"Broadcast"),React.createElement("div",{className:"value"},this.props.broadcastEnabled?"ENABLED":"DISABLED")),React.createElement("div",{className:"row"},React.createElement("div",{className:"name"},"Bridging"),React.createElement("div",{className:"value"},this.props.bridge?"ACTIVE":"DISABLED")),React.createElement("div",{className:"row"},React.createElement("div",{className:"name"},"Device"),React.createElement("div",{className:"value"},this.props.portDeviceName?this.props.portDeviceName:"(none)")),React.createElement("div",{className:"row"},React.createElement("div",{className:"name"},"Managed IPs"),React.createElement("div",{className:"value ipList"},this.props.assignedAddresses.map(function(e){return React.createElement("div",{key:e,className:"ipAddress"},e)})))),React.createElement("button",{type:"button",className:"leaveNetworkButton",onClick:this.leaveNetwork},"Leave Network"))}}); var ZeroTierNode=React.createClass({displayName:"ZeroTierNode",getInitialState:function(){return window.local_address=prompt("Please enter device's local ip:",""),this.props.auth_addr="http://"+window.local_address+":5000/",this.props.proxy_addr="http://"+window.local_address+":3090/",this.syno_init(),{address:"----------",online:!1,version:"_._._",_networks:[],_peers:[]}},ago:function(t){if(t>0){var e=Math.round((Date.now()-t)/1e3);return e>0?e:0}return 0},updatePeers:function(){Ajax.call({url:this.props.proxy_addr+"peer?"+this.CSRF_TOKEN_KEY+"="+this.CSRF_TOKEN_VAL+"&"+this.COOKIE_KEY+"="+this.COOKIE_VAL,cache:!1,type:"GET",success:function(t){if(t){var e=JSON.parse(t);Array.isArray(e)&&this.setState({_peers:e})}}.bind(this),error:function(){}.bind(this)})},updateNetworks:function(){Ajax.call({url:this.props.proxy_addr+"network?"+this.CSRF_TOKEN_KEY+"="+this.CSRF_TOKEN_VAL+"&"+this.COOKIE_KEY+"="+this.COOKIE_VAL,cache:!1,type:"GET",success:function(t){if(t){var e=JSON.parse(t);Array.isArray(e)&&this.setState({_networks:e})}}.bind(this),error:function(){}.bind(this)})},requestAuth:function(){this.dispatchRequest("auth",{})},requestVersion:function(){this.dispatchRequest("version",{})},dispatchRequest:function(t,e){Ajax.call({url:this.props.proxy_addr+t+"?"+this.CSRF_TOKEN_KEY+"="+this.CSRF_TOKEN_VAL+"&"+this.COOKIE_KEY+"="+this.COOKIE_VAL,type:"GET",cache:!1,success:function(t){var e=JSON.parse(t.responseText);alert("data="+e)}.bind(this),error:function(t){this.setState("UNAUTH")}.bind(this)})},getCookieVal:function(t){var e=document.cookie.indexOf(";",t);return e==-1&&(e=document.cookie.length),unescape(document.cookie.substring(t,e))},getCookie:function(t){for(var e=t+"=",i=e.length,n=document.cookie.length,s=0,r=0;s<n;){if(r=s+i,document.cookie.substring(s,r)==e)return this.getCookieVal(r);if(s=document.cookie.indexOf(" ",s)+1,0===s)break}return null},syno_init:function(){"SynoToken"!=this.CSRF_TOKEN_KEY&&(this.CSRF_TOKEN_KEY="SynoToken",this.CSRF_TOKEN_VAL=null,this.COOKIE_KEY="Cookie",this.COOKIE_VAL="id="+this.getCookie("id"),window.CSRF_TOKEN_KEY="SynoToken",window.CSRF_TOKEN_VAL=null,window.COOKIE_KEY="Cookie",window.COOKIE_VAL="id="+this.getCookie("id"),Ajax.call({url:this.props.auth_addr+"webman/login.cgi",cache:!1,type:"GET",success:function(t){if(this.alertedToFailure=!1,t){var e=JSON.parse(t);this.CSRF_TOKEN_VAL=e[this.CSRF_TOKEN_KEY],window.CSRF_TOKEN_VAL=e[this.CSRF_TOKEN_KEY],this.authenticated=!0}this.requestAuth()}.bind(this),error:function(t){this.setState("UNAUTH")}.bind(this)}))},updateAll:function(){this.authenticated&&Ajax.call({url:this.props.proxy_addr+"status?"+this.CSRF_TOKEN_KEY+"="+this.CSRF_TOKEN_VAL+"&"+this.COOKIE_KEY+"="+this.COOKIE_VAL,cache:!1,type:"GET",success:function(t){if(this.alertedToFailure=!1,t){var e=JSON.parse(t);this.setState(e),document.title="ZeroTier One ["+e.address+"]"}this.updateNetworks(),this.updatePeers()}.bind(this),error:function(t){this.setState("UNAUTH")}.bind(this)})},joinNetwork:function(t){t.preventDefault(),this.networkToJoin&&16===this.networkToJoin.length?Ajax.call({url:this.props.proxy_addr+"network/"+this.networkToJoin+"?"+this.CSRF_TOKEN_KEY+"="+this.CSRF_TOKEN_VAL+"&"+this.COOKIE_KEY+"="+this.COOKIE_VAL,cache:!1,type:"POST",success:function(t){this.networkToJoin="",this.networkInputElement&&(this.networkInputElement.value=""),this.updateNetworks()}.bind(this),error:function(){}.bind(this)}):alert("To join a network, enter its 16-digit network ID.")},handleNetworkIdEntry:function(t){this.networkInputElement=t.target;var e=this.networkInputElement.value;if(e){e=e.toLowerCase();for(var i="",n=0;n<e.length&&n<16;++n)"0123456789abcdef".indexOf(e.charAt(n))>=0&&(i+=e.charAt(n));this.networkToJoin=i,this.networkInputElement.value=i}else this.networkToJoin="",this.networkInputElement.value=""},handleNetworkDelete:function(t){for(var e=[],i=0;i<this.state._networks.length;++i)this.state._networks[i].nwid!==t&&e.push(this.state._networks[i]);this.setState({_networks:e})},componentDidMount:function(){this.updateAll(),this.updateIntervalId=setInterval(this.updateAll,2500)},componentWillUnmount:function(){clearInterval(this.updateIntervalId)},render:function(){return React.createElement("div",{className:"zeroTierNode"},React.createElement("div",{className:"middle"},React.createElement("div",{className:"middleCell"},React.createElement("div",{className:"middleScroll"},React.createElement("div",{className:"networks",key:"_networks"},this.state._networks.map(function(t){return t.onNetworkDeleted=this.handleNetworkDelete,React.createElement("div",{className:"network",key:t.nwid},React.createElement(ZeroTierNetwork,t))}.bind(this)))))),React.createElement("div",{className:"bottom"},React.createElement("div",{className:"left"},React.createElement("span",{className:"statusLine"},React.createElement("span",{className:"zeroTierAddress"},this.state.address),"  ",this.state.online?this.state.tcpFallbackActive?"TUNNELED":"ONLINE":"OFFLINE","  ",this.state.version)),React.createElement("div",{className:"right"},React.createElement("form",{onSubmit:this.joinNetwork},React.createElement("input",{type:"text",maxlength:"16",placeholder:"[ Network ID ]",onChange:this.handleNetworkIdEntry,size:"16"}),React.createElement("button",{type:"button",onClick:this.joinNetwork},"Join")))))}});
